pipeline {
    agent any

    environment {
        VENV = "./venv"
    }

    stages {
        stage('Start') {
            steps {
                echo 'ğŸ“¦ Pulling repo and starting test pipeline...'
            }
        }
stage('Set up venv & Run Selenium Tests') {
            steps {
                sh '''#!/bin/bash
                python3 -m venv $VENV
                source $VENV/bin/activate
                pip install --upgrade pip
                pip install selenium pytest
                cd selenium-tests
                pytest > result.log
                cat result.log
                '''
            }
        }stage('Deploy App (if tests pass)') {
            when {
                expression { currentBuild.currentResult == 'SUCCESS' }
            }
            steps {
                sh '''#!/bin/bash
                echo "ğŸ›  Redeploying app via Docker Compose..."
                docker-compose down
                docker-compose up -d --build
                '''
            }
        }
    }
 post {
        success {
            echo 'âœ… Tests passed and app deployed. Pipeline complete!'
        }
        failure {
            echo 'âŒ Tests failed or pipeline error occurred.'
        }
    }
}
